(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{"8KLx":function(t,e,s){},"8UJE":function(t,e,s){},IIHU:function(t,e,s){"use strict";var i=s("dk9J"),a=s.n(i);a.a},"Lwp/":function(t,e,s){"use strict";var i=s("8KLx"),a=s.n(i);a.a},O0VV:function(t,e,s){"use strict";var i=s("8UJE"),a=s.n(i);a.a},QZ2B:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"match-result-sheet"},t._l([0,1],function(e){return s("MatchResultSheetRow",{key:e,attrs:{player:"string"===typeof t.match["player"+(e+1)]?{}:t.match["player"+(e+1)],"win-rate":t.winRates[e],"result-list":t.resultLists[e],result:t.result[e],"points-assigned":t.match.pointsAssigned&&t.match.pointsAssigned[e],"show-border":0===e,"is-winner":void 0===t.winner?void 0:t.winner===e,"is-current-server":t.currentServer===e}})}))},a=[],n=s("k5N+"),r=(s("SRfc"),s("xfY5"),s("VRzm"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"match-result-sheet-row",class:{border:t.showBorder,winner:t.isWinner}},[s("span",{staticClass:"name"},[s("span",{staticClass:"prefix"},[t._v(t._s(t.prefix))]),t._v(t._s(t.player.fullname)),t.pointsAssigned?s("sup",[t._v(t._s(t.pointsAssigned>0?"+":"")+t._s(t.pointsAssigned))]):t._e(),t.pointsAssigned||void 0===t.winRate?t._e():s("sup",[t._v("("+t._s(t.winRate)+"%)")])]),t._l(t.resultList,function(e,i){return s("span",{key:i,staticClass:"score",class:{odd:i%2!==0,even:i%2===0}},[t._v(t._s(e))])}),s("span",{staticClass:"result"},[t._v(t._s(t.result))])],2)}),c=[],o={name:"MatchResultSheetRow",props:{player:{type:Object,default:function(){return{}}},winRate:{type:Number,default:void 0},resultList:{type:Array,default:function(){return[]}},result:{type:Number,default:0},pointsAssigned:{type:Number,default:0},isWinner:{type:Boolean,default:void 0},isCurrentServer:{type:Boolean,default:!1},showBorder:{type:Boolean,default:!1}},computed:{prefix:function(){return!0===this.isWinner?"🏆":void 0===this.isWinner&&this.isCurrentServer?"🏓":""}}},h=o,l=(s("Lwp/"),s("KHd+")),u=Object(l["a"])(h,r,c,!1,null,"6478e6c8",null),d=u.exports,f={name:"MatchResultSheet",components:{MatchResultSheetRow:d},props:{match:{type:Object,default:function(){return{}}},currentServer:{type:Number,default:void 0}},data:function(){return{playersHistory:void 0}},computed:{winRates:function(){if(this.playersHistory){if(0===this.playersHistory.total)return[void 0,void 0];var t=Math.ceil(this.playersHistory[this.match.player1.id]/this.playersHistory.total*100);return[t,100-t]}return[void 0,void 0]},resultLists:function(){var t=[[],[]];return this.match.resultTable.map(function(e){var s=Object(n["a"])(e,2),i=s[0],a=s[1];t[0].push(i),t[1].push(a)}),t},result:function(){var t=this;return this.match.resultTable.reduce(function(e,s){return s[0]-s[1]>=2&&s[0]>=t.match.pointsPerSet&&(e[0]+=1),s[1]-s[0]>=2&&s[1]>=t.match.pointsPerSet&&(e[1]+=1),e},[0,0])},isMatchFinished:function(){var t=Math.ceil(this.match.numberOfSets/2);return this.result[0]===t||this.result[1]===t},winner:function(){return this.isMatchFinished?this.result[0]>this.result[1]?0:1:void 0}},mounted:function(){var t=this;this.match.finished||this.$fns.httpsCallable("getPlayersHistory")({player1:this.match.player1.id,player2:this.match.player2.id}).then(function(e){var s=e.data;console.log(s),t.playersHistory=s}).catch(function(){console.error("Failed to load players history.")})}},p=f,m=(s("tY13"),Object(l["a"])(p,i,a,!1,null,null,null));e["a"]=m.exports},UExd:function(t,e,s){var i=s("DVgA"),a=s("aCFj"),n=s("UqcF").f;t.exports=function(t){return function(e){var s,r=a(e),c=i(r),o=c.length,h=0,l=[];while(o>h)n.call(r,s=c[h++])&&l.push(t?[s,r[s]]:r[s]);return l}}},VGlw:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("f7-page",[s("f7-page-content",{staticClass:"container"},[t.isGameLoaded?[void 0===t.match.firstServer?[s("div",{staticClass:"first-server-picker"},[t._l([t.match.player1,t.match.player2],function(e,i){return s("div",{key:i,staticClass:"player",class:{p2:1===i}},[s("img",{staticClass:"photoURL",attrs:{src:e.photoURL},on:{click:function(e){t.selectedFirstServer=i}}}),s("span",{staticClass:"name"},[t._v(t._s(t.selectedFirstServer===i?"🏓":"")+t._s(e.fullname))]),s("span",{staticClass:"points"},[t._v(t._s(t.match.isFinished?t.match.pointsBeforeMatch[i]:e.points))])])}),s("span",{staticClass:"v"},[t._v("V")]),s("span",{staticClass:"s"},[t._v("S")]),s("span",{staticClass:"instruction"},[t._v("Please select first server by clicking on player photo:")]),s("span",{directives:[{name:"show",rawName:"v-show",value:void 0!==t.selectedFirstServer,expression:"selectedFirstServer !== undefined"}],staticClass:"uk-button set-first-server",on:{click:t.confirmFisrtServer}},[t._v("Confirm")])],2)]:[s("f7-swiper",{staticClass:"swiper",attrs:{id:"swiper",init:t.isGameLoaded,navigation:""}},t._l(t.match.resultTable,function(e,i){return s("f7-swiper-slide",{key:i,staticClass:"scoreboard"},[s("div",{staticClass:"scores"},[s("div",[s("span",{on:{click:function(e){t.win(t.order[0])}}},[t._v("\n                  "+t._s(e[t.order[0]])+"\n                ")]),s("span",{staticClass:"decrease-button",on:{click:function(e){t.decrease(t.order[0])}}})]),s("span",[t._v(":")]),s("div",[s("span",{on:{click:function(e){t.win(t.order[1])}}},[t._v("\n                  "+t._s(e[t.order[1]])+"\n                ")]),s("span",{staticClass:"decrease-button",on:{click:function(e){t.decrease(t.order[1])}}})])])])})),s("div",{staticClass:"players"},[s("div",{staticClass:"player"},[s("img",{staticClass:"photoURL",attrs:{src:t.players[0].photoURL}}),s("div",{staticClass:"info"},[s("span",{staticClass:"name"},[t._v(t._s(t.players[0].fullname))]),s("span",{staticClass:"points"},[t._v(t._s(t.players[0].points))])])]),s("div",{staticClass:"player p2"},[s("div",{staticClass:"info"},[s("span",{staticClass:"name"},[t._v(t._s(t.players[1].fullname))]),s("span",{staticClass:"points"},[t._v(t._s(t.players[1].points))])]),s("img",{staticClass:"photoURL",attrs:{src:t.players[1].photoURL}})])]),s("match-result-sheet",{attrs:{match:t.match,"current-server":t.currentServer,winner:t.winner}}),s("span",{staticClass:"cheer-button",on:{click:function(e){t.cheer(0)}}},[t._v("🎉")]),s("span",{staticClass:"cheer-button",on:{click:function(e){t.cheer(1)}}},[t._v("🎉")]),s("f7-segmented",{staticClass:"menu"},[s("f7-button",{attrs:{color:"white",fill:"","icon-ion":"ios-chatboxes"},on:{click:function(e){t.leftPanelOpened=!0}}}),s("f7-button",{attrs:{color:"white",fill:"","icon-ion":"ios-more"},on:{click:function(e){t.rightPanelOpened=!0}}})],1),t.floatingMessage?s("div",{staticClass:"floating-message"},[t._v(t._s(t.floatingMessage))]):t._e(),s("div",{staticClass:"left-panel",class:{active:t.leftPanelOpened}},[s("chat"),s("div",{staticClass:"close-left-panel",class:{active:t.leftPanelOpened},on:{click:function(e){t.leftPanelOpened=!1}}})],1),s("div",{staticClass:"right-panel",class:{active:t.rightPanelOpened}},[t.canMakeChange?[t.match.finished?[s("span",[t._v("Match finished at "+t._s(t.format(t.match.finishedAt))+".")])]:[s("f7-button",{attrs:{disabled:!t.isMatchFinished,color:"black",fill:""},on:{click:t.save}},[t._v("Save")]),s("f7-button",{attrs:{color:"black"},on:{click:t.cancel}},[t._v("Cancel")])]]:[t.match.finished?[s("span",[t._v("Match finished at "+t._s(t.format(t.match.finishedAt))+".")])]:[s("span",[t._v("Match has been going for "+t._s(t.distanceInWordsToNow(t.match.createdAt))+".")])]],s("div",{staticClass:"separator"}),s("f7-button",{attrs:{color:"black"},on:{click:t.leave}},[t._v("Leave")]),s("div",{staticClass:"close-right-panel",class:{active:t.rightPanelOpened},on:{click:function(e){t.rightPanelOpened=!1}}})],2)]]:s("loader")],2)],1)},a=[],n=(s("rGqo"),s("f3/d"),s("yT7P")),r=(s("Z2Ku"),s("L9s1"),s("SRfc"),s("Kw5r")),c=s("cPJV"),o=s.n(c),h=s("YlT8"),l=s.n(h),u=s("VV+c"),d=s("QZ2B"),f=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chat"},[s("f7-messagebar",{ref:"messagebar",attrs:{disabled:!t.user,placeholder:t.user?"Chat now!":"Sign in to chat!"},on:{submit:t.onSubmit}},[s("f7-icon",{staticStyle:{color:"#17b492"},attrs:{slot:"send-link",ion:"ios-paper-plane",size:"22"},slot:"send-link"})],1),s("f7-messages",[0===t.messages.length?s("f7-messages-title",[t._v("Send the first message!")]):t._e(),t._l(t.messages,function(e,i){return s("f7-message",{key:e.id,attrs:{type:e.type,text:e.text,name:e.name,avatar:e.avatar,first:t.isFirstMessage(e,i),last:t.isLastMessage(e,i),tail:t.isTailMessage(e,i)}})})],2)],1)},p=[],m=(s("RW0V"),s("yt8O"),s("hhXQ"),function(){var t=[],e=void 0,s=void 0;return{add:function(e){t.push(e)},start:function(i){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=arguments.length>2?arguments[2]:void 0;s=setInterval(function(){t.length>0&&e===t[0]&&t.shift(),e=t.length>0?t[0]:n,i(e)},a),window.i=s},stop:function(){s&&clearInterval(s)}}}()),v=m,g={name:"Chat",props:{matchId:{type:String,default:""}},data:function(){return{messages:[]}},computed:{user:function(){return this.$root.user}},created:function(){var t=this;this.$db.ref("chats/".concat(this.matchId)).once("value").then(function(e){var s=e.val()||{};Object.values(s).forEach(function(e,i){t.messages.unshift({id:Object.keys(s)[i],text:e.content,type:e.sentBy===(t.user&&t.user.uid)?"sent":"received",sentBy:e.sentBy,name:"Someone"}),t.loadUserInfo(t.messages[0])}),t.$db.ref("chats/".concat(t.matchId)).orderByChild("createdAt").startAt(Date.now()).on("child_added",function(e){var s=e.val();t.messages.unshift({id:e.key,text:s.content,type:s.sentBy===(t.user&&t.user.uid)?"sent":"received",sentBy:s.sentBy,name:"Someone"}),t.loadUserInfo(t.messages[0],!0)})})},methods:{loadUserInfo:function(t,e){this.$db.ref("users/".concat(t.sentBy)).on("value",function(s){var i=s.val();i&&(r["a"].set(t,"name",i.fullname),r["a"].set(t,"avatar",i.photoURL),e&&v.add("".concat(i.fullname,": ").concat(t.text)))})},isFirstMessage:function(t,e){var s=this.messages[e-1];return!s||s.type!==t.type||s.name!==t.name},isLastMessage:function(t,e){var s=this.messages[e+1];return!s||s.type!==t.type||s.name!==t.name},isTailMessage:function(t,e){var s=this.messages[e+1];return!s||s.type!==t.type||s.name!==t.name},onSubmit:function(t){var e=this;t&&this.user&&this.$db.ref("chats/".concat(this.matchId)).push({content:t,sentBy:this.user.uid,createdAt:(new Date).getTime()}).then(function(){e.$refs.messagebar.f7Messagebar.clear()})}}},y=g,w=(s("IIHU"),s("KHd+")),S=Object(w["a"])(y,f,p,!1,null,null,null),b=S.exports,C={name:"Scoreboard",components:{Loader:u["a"],MatchResultSheet:d["a"],Chat:b},data:function(){return{match:null,selectedFirstServer:void 0,currentDisplayingSet:0,isSwiperListenerSet:!1,leftPanelOpened:!1,rightPanelOpened:!1,floatingMessage:void 0}},computed:{isGameLoaded:function(){return this.match&&"string"!==typeof this.match.createdBy&&"string"!==typeof this.match.judge&&"string"!==typeof this.match.player1&&"string"!==typeof this.match.player2},canMakeChange:function(){return this.isGameLoaded&&[this.match.judge.id,this.match.createdBy.id].includes(this.$root.user&&this.$root.user.uid)},firstServer:function(){return(this.match.firstServer+this.currentDisplayingSet%2)%2},currentServer:function(){var t=this.match.resultTable[this.currentDisplayingSet].reduce(function(t,e){return t+e},0),e=this.hasReachedTenTen?(t-20)%2===0?0:1:Math.round((t+1)/2)%2?0:1;return 0===this.firstServer?e:e?0:1},currentReceiver:function(){return 0==this.currentServer?1:0},order:function(){var t=this.currentDisplayingSet%2,e=0===t?1:0;return[t,e]},players:function(){return[this.match["player".concat(this.order[0]+1)],this.match["player".concat(this.order[1]+1)]]},result:function(){var t=this;return this.match.resultTable.reduce(function(e,s){return s[0]-s[1]>=2&&s[0]>=t.match.pointsPerSet&&(e[0]+=1),s[1]-s[0]>=2&&s[1]>=t.match.pointsPerSet&&(e[1]+=1),e},[0,0])},currentPlayingSet:function(){return Math.max(0,this.result[0]+this.result[1]-1)},hasReachedTenTen:function(){return this.match.resultTable[this.currentDisplayingSet][0]>=10&&this.match.resultTable[this.currentDisplayingSet][0]>=10},isMatchSaved:function(){return this.match.finished},isMatchFinished:function(){if(this.isMatchSaved)return!0;var t=Math.ceil(this.match.numberOfSets/2);return this.result[0]===t||this.result[1]===t},winner:function(){return this.isMatchFinished?this.result[0]>this.result[1]?0:1:void 0},user:function(){return this.$root.$data.user}},updated:function(){var t=this;!0!==this.isGameLoaded||void 0===this.match.firstServer||this.isSwiperListenerSet||(this.isSwiperListenerSet=!0,this.$nextTick(function(){var e=t.$f7.swiper.get("#swiper");e.on("slideChange",function(){t.currentDisplayingSet=e.activeIndex})}))},created:function(){var t=this,e=this.$f7route.params.id;v.start(function(e){t.floatingMessage=e},2500),this.$db.ref("matches/".concat(e)).on("value",function(s){var i=s.val();return i?t.isGameLoaded?(delete i.createdBy,delete i.judge,delete i.player1,delete i.player2,void(t.match=Object(n["a"])({},t.match,i))):(t.match=Object(n["a"])({},i,{id:e}),void t.loadUserInfo()):(t.$f7router.navigate("/matches",{reloadCurrent:!0}),void t.$f7.toast.show({text:"Match not found.",closeTimeout:3e3}))}),this.$db.ref("cheers/".concat(e)).orderByChild("createdAt").startAt(Date.now()).on("child_added",function(e){var s=e.val();t.user&&s.uid===t.user.uid||(t.fire(s.to),v.add("".concat(s.name," cheered for ").concat(t.match["player".concat(s.to+1)].fullname,"!")))}),window.addEventListener("orientationchange",function(){setTimeout(window._resetCanvasSize,500)})},beforeDestroy:function(){v.stop()},methods:{format:function(t){return o()(new Date(t),"YYYY-MM-DD HH:mm")},distanceInWordsToNow:function(t){return l()(new Date(t))},loadUserInfo:function(){var t=this;["createdBy","judge","player1","player2"].forEach(function(e){t.$db.ref("users/".concat(t.match[e])).on("value",function(s){r["a"].set(t.match,e,Object(n["a"])({},s.val(),{id:s.key}))})})},confirmFisrtServer:function(){var t=this;this.canMakeChange&&(this.$f7.dialog.preloader("Setting first server..."),this.$db.ref("matches/".concat(this.match.id,"/firstServer")).set(this.selectedFirstServer).then(function(){t.$f7.dialog.close()}).catch(function(e){t.$f7.toast.show({text:e.message,closeTimeout:3e3}),t.$f7.dialog.close()}))},isGameFinished:function(t){var e=t[0]-t[1]>=2&&t[0]>=this.match.pointsPerSet,s=t[1]-t[0]>=2&&t[1]>=this.match.pointsPerSet;return e||s},broadcastCurrentResult:function(){var t=this.match.resultTable[this.currentDisplayingSet][0]+this.match.resultTable[this.currentDisplayingSet][1],e=this.match.resultTable[this.currentDisplayingSet][0]>this.match.resultTable[this.currentDisplayingSet][1]?0:1,s=this.isGameFinished(this.match.resultTable[this.currentDisplayingSet])?"".concat(this.match["player".concat(e+1)].fullname," won"):"".concat(this.match["player".concat(this.currentServer+1)].fullname,"'s serve.'"),i=t%2===0?"".concat(this.match.resultTable[this.currentDisplayingSet][this.currentReceiver]," : ").concat(this.match.resultTable[this.currentDisplayingSet][this.currentServer],", ").concat(this.match.resultTable[this.currentDisplayingSet][this.currentServer]," : ").concat(this.match.resultTable[this.currentDisplayingSet][this.currentReceiver],", ").concat(s,"."):"".concat(this.match.resultTable[this.currentDisplayingSet][this.currentServer]," : ").concat(this.match.resultTable[this.currentDisplayingSet][this.currentReceiver],", ").concat(s,"."),a=new SpeechSynthesisUtterance(i);a.voice=window.speechSynthesis.getVoices()[49],window.speechSynthesis.speaking&&window.speechSynthesis.cancel(),window.speechSynthesis.speak(a)},win:function(t){var e=this;if(this.canMakeChange)if(this.isMatchFinished)this.$f7.toast.show({text:"Match is finished.",closeTimeout:3e3});else if(this.currentDisplayingSet>0&&!this.isGameFinished(this.match.resultTable[this.currentDisplayingSet-1]))this.$f7.toast.show({text:"Please finish the previous game.",closeTimeout:3e3});else{var s=this.match.resultTable[this.currentDisplayingSet];this.isGameFinished(s)?this.$f7.toast.show({text:"Game is finished.",closeTimeout:3e3}):this.$db.ref("matches/".concat(this.match.id,"/resultTable/").concat(this.currentDisplayingSet,"/").concat(t)).set(this.match.resultTable[this.currentDisplayingSet][t]+1).then(function(){e.broadcastCurrentResult()}).catch(function(t){e.$f7.toast.show({text:t.message,closeTimeout:3e3})})}},decrease:function(t){var e=this;if(this.canMakeChange)if(this.isMatchSaved)this.$f7.toast.show({text:"Match is already saved.",closeTimeout:3e3});else{var s=this.match.resultTable[this.currentDisplayingSet];if(0!==s[t]){var i=0===t?1:0,a=s[i]>s[t]&&this.isGameFinished(s);a||this.$db.ref("matches/".concat(this.match.id,"/resultTable/").concat(this.currentDisplayingSet,"/").concat(t)).set(this.match.resultTable[this.currentDisplayingSet][t]-1).catch(function(t){e.$f7.toast.show({text:t.message,closeTimeout:3e3})})}}},save:function(){this.canMakeChange&&this.$f7.dialog.confirm("Do you want to save match now?","Save Match",this.confirmSave)},confirmSave:function(){var t=this;this.canMakeChange&&(this.$f7.dialog.preloader("Saving match..."),this.$fns.httpsCallable("saveMatch")({matchId:this.match.id}).then(function(){t.$f7.dialog.close(),t.$f7.toast.show({text:"Match saved.",closeTimeout:3e3})}).catch(function(e){t.$f7.dialog.close(),t.$f7.toast.show({text:e.message,closeTimeout:3e3})}))},cancel:function(){this.canMakeChange&&this.$f7.dialog.confirm("Do you want to cancel this match? Note: when a game is canceled, it will be removed completely.","Cancel Match",this.confirmCancel)},confirmCancel:function(){var t=this;this.canMakeChange&&(this.$f7.dialog.preloader("Canceling match..."),this.$fns.httpsCallable("cancelMatch")({matchId:this.match.id}).then(function(){t.$f7.dialog.close(),t.$f7.toast.show({text:"Match canceled.",closeTimeout:3e3})}).catch(function(e){t.$f7.dialog.close(),t.$f7.toast.show({text:e.message,closeTimeout:3e3})}))},leave:function(){var t=this;this.$f7.dialog.confirm("Do you want to leave this match and go back to matches page?","Leave Match",function(){t.$f7router.navigate("/matches",{reloadCurrent:!0})})},cheer:function(t){this.user?(this.fire(t),this.$db.ref("cheers/".concat(this.match.id)).push({uid:this.user&&this.user.uid,createdAt:(new Date).getTime(),to:t,name:this.user.fullname})):this.$f7.toast.show({text:"Please sign in first.",closeTimeout:3e3})},fire:function(t){var e=window.devicePixelRatio||1,s=0===t?32*e:(window.innerWidth-32)*e,i=(window.innerHeight-32-16)*e,a=0===t?315:-135;window.confettiCannon.fire(s,i,a)}}},_=C,M=(s("O0VV"),Object(w["a"])(_,i,a,!1,null,"5a054f9f",null));e["default"]=M.exports},"VV+c":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("img",{staticClass:"loader",attrs:{src:s("WbWX")}})},a=[],n={name:"Loader"},r=n,c=(s("xqeh"),s("KHd+")),o=Object(c["a"])(r,i,a,!1,null,"1b069888",null);e["a"]=o.exports},WbWX:function(t,e,s){t.exports=s.p+"img/ping-pong.0bd675f4.gif"},dk9J:function(t,e,s){},"f3/d":function(t,e,s){var i=s("hswa").f,a=Function.prototype,n=/^\s*function ([^ (]*)/,r="name";r in a||s("nh4g")&&i(a,r,{configurable:!0,get:function(){try{return(""+this).match(n)[1]}catch(t){return""}}})},hSuW:function(t,e,s){},hhXQ:function(t,e,s){var i=s("XKFU"),a=s("UExd")(!1);i(i.S,"Object",{values:function(t){return a(t)}})},tY13:function(t,e,s){"use strict";var i=s("vAUg"),a=s.n(i);a.a},vAUg:function(t,e,s){},xqeh:function(t,e,s){"use strict";var i=s("hSuW"),a=s.n(i);a.a}}]);
//# sourceMappingURL=7.295c2e25.js.map